#!/bin/sh
set -e

#--------------------------------------------------------------------------------------------------
# Settings
#--------------------------------------------------------------------------------------------------

SSL_version="3.4.1"

#--------------------------------------------------------------------------------------------------
# Syntax
#--------------------------------------------------------------------------------------------------

if [ $# != 1 ] || [ $1 != "linux" ]; then

    echo "Usage: ssl <linux>"

    exit 1
fi

#--------------------------------------------------------------------------------------------------
# Configuration
#--------------------------------------------------------------------------------------------------

external="$PWD/linux"

SSL="$external/OpenSSL/$SSL_version"

#--------------------------------------------------------------------------------------------------
# Build
#--------------------------------------------------------------------------------------------------

name="openssl-$SSL_version"

archive="$name.tar.gz"

curl -L -O "https://github.com/openssl/openssl/releases/download/$name/$archive"

tar -xvzf $archive

rm -rf $archive

cd $name

./config --prefix=/usr/local/ssl --openssldir=/usr/local/ssl shared

make -j$(nproc)

sudo cp libssl.so.3    "$SSL"
sudo cp libcrypto.so.3 "$SSL"

cd ..

rm -rf $name
